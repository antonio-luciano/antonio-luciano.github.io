<!doctype html><html lang="pt-BR" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index, follow"><meta name="description" content="<p><br /></p>"><title>Definir Wallpaper via Intune com Atualiza√ß√£o Din√¢mica | Antonio¬†Luciano</title><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Definir Wallpaper via Intune com Atualiza√ß√£o Din√¢mica" /><meta name="author" content="Antonio Luciano" /><meta property="og:locale" content="pt_BR" /><meta name="description" content="A minimal, responsive and feature-rich Jekyll theme for technical writing." /><meta property="og:description" content="A minimal, responsive and feature-rich Jekyll theme for technical writing." /><link rel="canonical" href="https://tonho.cloud/posts/WallpaperIntune/" /><meta property="og:url" content="https://tonho.cloud/posts/WallpaperIntune/" /><meta property="og:site_name" content="Antonio¬†Luciano" /><meta property="og:image" content="https://tonho.cloud/assets/images/Post04/post04-thumb.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-05-30T16:00:00-03:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://tonho.cloud/assets/images/Post04/post04-thumb.png" /><meta property="twitter:title" content="Definir Wallpaper via Intune com Atualiza√ß√£o Din√¢mica" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Antonio Luciano"},"dateModified":"2025-05-30T16:00:00-03:00","datePublished":"2025-05-30T16:00:00-03:00","description":"A minimal, responsive and feature-rich Jekyll theme for technical writing.","headline":"Definir Wallpaper via Intune com Atualiza√ß√£o Din√¢mica","image":"https://tonho.cloud/assets/images/Post04/post04-thumb.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://tonho.cloud/posts/WallpaperIntune/"},"url":"https://tonho.cloud/posts/WallpaperIntune/"}</script><meta property="og:image" content="https://tonho.cloud/assets/images/Post04/post04-thumb.png" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://tonho.cloud/assets/images/Post04/post04-thumb.png" /><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Antonio&nbsp;Luciano"><meta name="application-name" content="Antonio&nbsp;Luciano"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "WebSite", "name": "Antonio&nbsp;Luciano", "url": "https://tonho.cloud" } </script><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"><link rel="alternate" type="application/rss+xml" title="Tonho Cloud RSS Feed" href="/feed.xml"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/pt.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script><link rel="icon" href="/assets/images/favicon.png" type="image/png"><link rel="stylesheet" href="/assets/css/custom.css"><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/images/avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Antonio&nbsp;Luciano</a><p class="site-subtitle fst-italic mb-0">Cloud Security Expert <br> Microsoft Azure | Microsoft 365</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARQUIVOS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/sobre/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>SOBRE</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/antonio-luciano" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://www.linkedin.com/in/antoniolucianojunior/" aria-label="linkedin" target="_blank" rel="noopener noreferrer" > <i class="fab fa-linkedin"></i> </a> <a href="javascript:location.href = 'mailto:' + ['security','tonho.cloud'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Definir Wallpaper via Intune com Atualiza√ß√£o Din√¢mica</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancelar</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="post"><header class="post-header"><h1 class="post-title">Definir Wallpaper via Intune com Atualiza√ß√£o Din√¢mica</h1><div class="post-meta"> <span class="post-author">Por Antonio Luciano</span> <span class="post-date">May 30, 2025</span></div></header><div class="post-content"><p><br /></p><p>Ol√°, pessoal!</p><p style="text-align: justify;">Voc√™s sabem que aplicar um papel de parede nos computadores da companhia, √© uma tarefa muito normal em praticamente todas as empresas, n√£o √© verdade?! E executar esta "modesta" atividade via Microsoft Intune parece simples √† primeira vista, no entanto, quem j√° tentou fazer isso em m√°quinas com <strong>Windows 10/11 Pro</strong> sabe que a abordagem padr√£o, usando perfis de restri√ß√£o de dispositivo, esbarra em algumas limita√ß√µes.</p><p style="text-align: justify;">Este post, inspirado no excelente artigo do MVP 'Gannon Novak' do site <a href="https://smbtothecloud.com" target="_blank" rel="noopener noreferrer">SMBtotheCloud</a> vai lhe mostrar atrav√©s de uma √≥timo solu√ß√£o alternativa, como usar scripts PowerShell e a implanta√ß√£o de aplicativos Win32 no Microsoft Intune para aplicar este tipo de configura√ß√£o. Vamos n√£o apenas configurar o Wallpaper, mas tamb√©m implementar um m√©todo inteligente para atualiz√°-lo dinamicamente, sem a necessidade de reempacotar e redistribuir o aplicativo ou ajustar o script a cada mudan√ßa.</p><h2 id="-o-desafio-por-que-o-m√©todo-padr√£o-falha-no-windows-10-pro"><span class="me-2">üé∞ O Desafio: Por que o m√©todo padr√£o falha no Windows 10 Pro?</span><a href="#-o-desafio-por-que-o-m√©todo-padr√£o-falha-no-windows-10-pro" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p style="text-align: justify;">A forma mais direta de configurar o papel de parede no Intune √© atrav√©s de um Perfil de Configura√ß√£o de Dispositivo &gt; Restri√ß√µes de Dispositivo. L√°, voc√™ encontra op√ß√µes para especificar URLs para as imagens desejadas. Simples, certo? O problema √© que essas configura√ß√µes espec√≠ficas s√£o aplic√°veis apenas √†s edi√ß√µes <strong>Enterprise</strong> e <strong>Education</strong> do Windows 10/11. <br /></p><p style="text-align: justify;">Se voc√™ tentar aplicar esse perfil a um dispositivo com Windows 10/11 Pro, o status da pol√≠tica no Intune mostrar√° "N√£o aplic√°vel". Precisamos ent√£o, de um caminho alternativo. Bora!</p><h2 id="-a-solu√ß√£o-scripts-powershell-e-o-registro-do-windows"><span class="me-2">üéØ A Solu√ß√£o: Scripts PowerShell e o Registro do Windows</span><a href="#-a-solu√ß√£o-scripts-powershell-e-o-registro-do-windows" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p style="text-align: justify;">Quando as pol√≠ticas padr√£o n√£o funcionam, muitas vezes a solu√ß√£o est√° em manipular diretamente o Registro do Windows. √â exatamente isso que faremos. Vamos usar scripts PowerShell para:</p><ul><li>Criar as chaves e valores necess√°rios no registro para definir a imagem;<li>Baixar a imagem desejada de um local acess√≠vel (como o Azure Blob Storage);<li>Configurar o sistema para usar a imagem baixada;</ul><p style="text-align: justify;">Para distribuir e executar esses scripts de forma gerenciada atrav√©s do Intune, utilizaremos o recurso de implanta√ß√£o de Aplicativos Win32.</p><p><strong>O Script de Instala√ß√£o (Configura√ß√£o Inicial)</strong></p><p style="text-align: justify;">O primeiro passo √© criar um script PowerShell que far√° a configura√ß√£o inicial. Este script ser√° empacotado como um aplicativo Win32, como j√° informado. Abaixo o c√≥digo, com as explica√ß√µes:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c"># Garante que o caminho base no registro exista, sen√£o ser√° criado</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nx">HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\PersonalizationCSP</span><span class="w"> </span><span class="nt">-Force</span><span class="w">

</span><span class="c"># Caminho base no registro onde as configura√ß√µes ser√£o aplicadas</span><span class="w">
</span><span class="nv">$RegPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\PersonalizationCSP"</span><span class="w">

</span><span class="c"># URL da imagem (substitua pelo seu link - Ex: Azure Blob Storage)</span><span class="w">
</span><span class="nv">$BackgroundImageURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'https://seu_storage.blob.core.windows.net/wallpaper/background.jpg'</span><span class="w">

</span><span class="c"># Pasta local onde a imagem ser√° salva no cliente</span><span class="w">
</span><span class="nv">$ImageDestinationFolder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"C:\MDM\images"</span><span class="w">

</span><span class="c"># Caminho completo para o arquivo da imagem local</span><span class="w">
</span><span class="nv">$Backgroundimage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="nv">$ImageDestinationFolder</span><span class="s2">\background.jpg"</span><span class="w">

</span><span class="c"># Cria a pasta C:\MDM\images se ela n√£o existir. O -ErrorAction SilentlyContinue evita erros caso a pasta j√° exista.</span><span class="w">
</span><span class="n">md</span><span class="w"> </span><span class="nv">$ImageDestinationFolder</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">

</span><span class="c"># Usa o BITS (Background Intelligent Transfer Service) para baixar a imagem da URL especificada</span><span class="w">
</span><span class="n">Start-BitsTransfer</span><span class="w"> </span><span class="nt">-Source</span><span class="w"> </span><span class="nv">$BackgroundImageURL</span><span class="w"> </span><span class="nt">-Destination</span><span class="w"> </span><span class="s2">"</span><span class="nv">$Backgroundimage</span><span class="s2">"</span><span class="w">

</span><span class="c"># Configura√ß√£o das Chaves do Registro para o Papel de Parede</span><span class="w">
</span><span class="n">New-ItemProperty</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$RegPath</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">DesktopImagePath</span><span class="w"> </span><span class="nt">-Value</span><span class="w"> </span><span class="nv">$backgroundimage</span><span class="w"> </span><span class="nt">-PropertyType</span><span class="w"> </span><span class="nx">String</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">
</span><span class="nx">New-ItemProperty</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$RegPath</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">DesktopImageUrl</span><span class="w"> </span><span class="nt">-Value</span><span class="w"> </span><span class="nv">$backgroundimage</span><span class="w"> </span><span class="nt">-PropertyType</span><span class="w"> </span><span class="nx">String</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">
</span><span class="nx">New-ItemProperty</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$RegPath</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">DesktopImageStatus</span><span class="w"> </span><span class="nt">-Value</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nt">-PropertyType</span><span class="w"> </span><span class="nx">DWORD</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-Null</span><span class="w">

</span><span class="kr">exit</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></pre></table></code></div></div><p>Pontos importantes sobre este script:<br /></p><ul><li><p style="text-align: justify;"><strong>URL da Imagem:</strong> Voc√™ precisa substituir a URL de exemplo ($BackgroundImageURL) pela URL real onde sua imagem est√° hospedada. O Azure Blob Storage √© uma √≥tima op√ß√£o, garantindo que a imagem esteja acess√≠vel publicamente (ou via SAS token, se necess√°rio, mas o script assume acesso an√¥nimo aqui).</p><li><p style="text-align: justify;"><strong>Nome do Arquivo:</strong> O script assume que a imagem se chamar√° 'background.jpg'. Manter esse nome √© crucial para o funcionamento do script de detec√ß√£o que veremos a seguir. Se mudar o nome do arquivo, n√£o esque√ßa de mudar no script.</p><li><strong>Pasta de Destino:</strong> A imagem √© salva em ‚ÄòC:\MDM\Images‚Äô. Certifique-se de que n√£o haja pol√≠ticas bloqueando a cria√ß√£o ou escrita nesta pasta, ou ajuste o caminho ($ImageDestinationFolder) conforme necess√°rio.<br /></ul><p><br /> Abaixo, o script de <strong>Uninstall</strong>, que nada mais √© que, a remo√ß√£o das chaves de registro:</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">Remove-ItemProperty</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\PersonalizationCSP"</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"DesktopImagePath"</span><span class="w">
</span><span class="n">Remove-ItemProperty</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\PersonalizationCSP"</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"DesktopImageUrl"</span><span class="w">
</span><span class="n">Remove-ItemProperty</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="s2">"HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\PersonalizationCSP"</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"DesktopImageStatus"</span><span class="w">
</span><span class="kr">exit</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span></pre></table></code></div></div><h2 id="-o-desafio-da-atualiza√ß√£o-e-o-script-de-detec√ß√£o-inteligente"><span class="me-2">üé∞ O Desafio da Atualiza√ß√£o e o Script de Detec√ß√£o Inteligente</span><a href="#-o-desafio-da-atualiza√ß√£o-e-o-script-de-detec√ß√£o-inteligente" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Ok, a configura√ß√£o inicial est√° resolvida. Mas e se a empresa quiser trocar as imagens de vez em quando, ou para campanhas espec√≠ficas? Com a abordagem Win32 App padr√£o, ter√≠amos que:</p><ul><li>Atualizar a imagem no Blob Storage;<li>(Potencialmente) Alterar o script de instala√ß√£o se algo mudasse;<li>Reempacotar o script usando a Ferramenta de Prepara√ß√£o de Conte√∫do Win32 da Microsoft (IntuneWinAppUtil.exe);<li>Fazer upload da nova vers√£o do arquivo .intunewin para o Intune;<li>Aguardar a distribui√ß√£o e instala√ß√£o nos clientes;</ul><p style="text-align: justify;">Isso √© trabalhoso e propenso a erros. A beleza da solu√ß√£o proposta pelo 'Gannon Novak' est√° no script de detec√ß√£o personalizado.</p><p style="text-align: justify;">O Intune, ao implantar um aplicativo Win32, usa regras de detec√ß√£o para verificar se o aplicativo j√° est√° instalado corretamente. Normalmente, isso envolve verificar a exist√™ncia de um arquivo, pasta ou chave de registro espec√≠fica. No nosso caso, usaremos um script PowerShell personalizado como regra de detec√ß√£o.</p><p><u>Este script de detec√ß√£o far√° o seguinte:</u></p><ol><li>Baixar√° a vers√£o atual da imagem (background.jpg) do Blob Storage para uma pasta tempor√°ria;<li>Comparar√° a data/hora da √∫ltima modifica√ß√£o (<em>timestamp</em>) dessa imagem rec√©m-baixada com a imagem que j√° est√° na pasta C:\MDM\images do cliente;<li>Verificar√° tamb√©m se as chaves de registro relevantes est√£o configuradas corretamente;<li>Se o <em>timestamp</em> da imagem local e remota coincidirem e as chaves de registro estiverem corretas, o script retornar√° <strong>‚ÄúDetected‚Äù</strong> (indicando que a vers√£o correta j√° est√° instalada).<li><p style="text-align: justify;">Se os timestamp diferirem (significando que a imagem no Blob Storage foi atualizada) ou se as chaves de registro estiverem incorretas, o script sair√° com um c√≥digo de erro (exit 1), sinalizando ao Intune que a "aplica√ß√£o" (nossa imagem e configura√ß√µes) n√£o est√° no estado desejado. Isso far√° com que o Intune execute novamente o script de instala√ß√£o (Parte 1), que baixar√° a nova imagem e reconfigurar√° o registro.<br /> Isso permite que voc√™ simplesmente substitua o arquivo background.jpg no seu Blob Storage. Na pr√≥xima vez que o Intune avaliar a pol√≠tica de detec√ß√£o nos clientes (o que ocorre periodicamente), ele perceber√° a mudan√ßa nos <em>timestamps</em> e automaticamente executar√° o script de instala√ß√£o para atualizar a imagem nos endpoints, sem nenhuma interven√ß√£o manual no Intune!</p><p><br /> <strong>Script de detec√ß√£o:</strong></p></ol><div class="language-powershell highlighter-rouge"><div class="code-header"> <span data-label-text="Powershell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="c"># URL da imagem (DEVE ser a mesma do script de instala√ß√£o)</span><span class="w">
</span><span class="nv">$BackgroundImageURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'https://seu_storage.blob.core.windows.net/wallpaper/background.jpg'</span><span class="w">

</span><span class="c"># Pasta tempor√°ria para baixar a imagem para verifica√ß√£o</span><span class="w">
</span><span class="nv">$TempImageDestinationFolder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"C:\MDM\images\temp"</span><span class="w">

</span><span class="c"># Caminho completo para o arquivo tempor√°rio</span><span class="w">
</span><span class="nv">$TempBackgroundimage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="nv">$TempImageDestinationFolder</span><span class="s2">\background.jpg"</span><span class="w">

</span><span class="c"># Caminho da imagem atualmente em uso no cliente</span><span class="w">
</span><span class="nv">$CurrentBackgroundImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"C:\MDM\images\background.jpg"</span><span class="w">

</span><span class="c"># --- Cria√ß√£o do Diret√≥rio Tempor√°rio ---</span><span class="w">
</span><span class="n">md</span><span class="w"> </span><span class="nv">$TempImageDestinationFolder</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">

</span><span class="c"># Baixa a imagem mais recentes do Blob para a pasta tempor√°ria</span><span class="w">
</span><span class="n">Start-BitsTransfer</span><span class="w"> </span><span class="nt">-Source</span><span class="w"> </span><span class="nv">$BackgroundImageURL</span><span class="w"> </span><span class="nt">-Destination</span><span class="w"> </span><span class="s2">"</span><span class="nv">$TempBackgroundimage</span><span class="s2">"</span><span class="w">

</span><span class="c"># Pega o timestamp da imagem de fundo baixada do Blob</span><span class="w">
</span><span class="nv">$BlobBackgroundTimestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ItemProperty</span><span class="w"> </span><span class="s2">"</span><span class="nv">$TempBackgroundimage</span><span class="s2">"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">LastWriteTime</span><span class="w">

</span><span class="c"># Pega o timestamp da imagem de fundo atualmente no cliente (se existir)</span><span class="w">
</span><span class="nv">$CurrentBackgroundTimestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ItemProperty</span><span class="w"> </span><span class="s2">"</span><span class="nv">$CurrentBackgroundImage</span><span class="s2">"</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-ExpandProperty</span><span class="w"> </span><span class="nx">LastWriteTime</span><span class="w">

</span><span class="c"># Verifica se os valores de registro esperados existem e est√£o corretos</span><span class="w">
</span><span class="nv">$RegDesktopPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ItemPropertyValue</span><span class="w"> </span><span class="s2">"HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\PersonalizationCSP"</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"DesktopImagePath"</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
</span><span class="nv">$RegDesktopStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ItemPropertyValue</span><span class="w"> </span><span class="s2">"HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\PersonalizationCSP"</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"DesktopImageStatus"</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">
</span><span class="nv">$RegDesktopUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ItemPropertyValue</span><span class="w"> </span><span class="s2">"HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\PersonalizationCSP"</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"DesktopImageUrl"</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">

</span><span class="c"># Remove a pasta tempor√°ria e seu conte√∫do ap√≥s a verifica√ß√£o</span><span class="w">
</span><span class="n">Remove-Item</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$TempImageDestinationFolder</span><span class="w"> </span><span class="nt">-Recurse</span><span class="w"> </span><span class="nt">-Force</span><span class="w"> </span><span class="nt">-ErrorAction</span><span class="w"> </span><span class="nx">SilentlyContinue</span><span class="w">

</span><span class="c"># Compara os timestamps e os valores do registro</span><span class="w">
</span><span class="kr">If</span><span class="w"> </span><span class="p">((</span><span class="nv">$CurrentBackgroundTimestamp</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$BlobBackgroundTimestamp</span><span class="p">)</span><span class="w"> </span><span class="o">-and</span><span class="w"> 
    </span><span class="p">(</span><span class="nv">$RegDesktopStatus</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-and</span><span class="w"> 
    </span><span class="p">(</span><span class="nv">$RegDesktopPath</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$CurrentBackgroundImage</span><span class="p">)</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="p">(</span><span class="nv">$RegDesktopUrl</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="nv">$CurrentBackgroundImage</span><span class="p">))</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="c"># Se tudo estiver correto e atualizado, escreve "Detected" para o Intune</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Detected"</span><span class="w">
    </span><span class="kr">exit</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="kr">Else</span><span class="w"> 
</span><span class="p">{</span><span class="w">
    </span><span class="c"># Se algo estiver desatualizado ou incorreto, informa e sai com erro (for√ßa a reinstala√ß√£o)</span><span class="w">
    </span><span class="n">Write-Host</span><span class="w"> </span><span class="s2">"Imagem desatualizada ou valores de registro ausentes/incorretos."</span><span class="w">
    </span><span class="kr">exit</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><h2 id="-empacotando-e-implantando-via-intune"><span class="me-2">üì¶ Empacotando e Implantando via Intune</span><a href="#-empacotando-e-implantando-via-intune" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Agora que temos os dois scripts (instala√ß√£o e detec√ß√£o), precisamos empacotar o script de instala√ß√£o como um aplicativo Win32 e configur√°-lo no Intune.</p><ul><li><strong>Salve os Scripts:</strong> Salve o script de instala√ß√£o como <strong>install.ps1</strong> e o script de detec√ß√£o como <strong>detect.ps1</strong>;<li><strong>Baixe a Ferramenta de Prepara√ß√£o:</strong> Obtenha a Ferramenta de Prepara√ß√£o de Conte√∫do do Microsoft Win32 (IntuneWinAppUtil.exe) no GitHub oficial da Microsoft: <a href="https://github.com/microsoft/Microsoft-Win32-Content-Prep-Tool" target="_blank" rel="noopener noreferrer">Microsoft Win32 Content Prep Tool</a><li><strong>Empacote o Script de Instala√ß√£o:</strong><li>Crie uma pasta de origem (ex: C:\Fonte_wallpaper) e coloque o <strong>install.ps1</strong> dentro dela;<li>Crie uma pasta de sa√≠da (ex: C:\Build_wallpaper);<li>Abra o Prompt de Comando ou PowerShell, navegue at√© onde voc√™ salvou o <strong>IntuneWinAppUtil.exe</strong> e execute:<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>IntuneWinAppUtil.exe <span class="nt">-c</span> C:<span class="se">\F</span>onte_wallpaper <span class="nt">-s</span> install.ps1 <span class="nt">-o</span> C:<span class="se">\B</span>uild_wallpaper
</pre></table></code></div></div><blockquote><p><small><em>Ser√° criado o arquivo <strong>install.intunewin</strong> no diret√≥rio de sa√≠da. √â ele que voc√™ far√° *upload</em> para o Intune.*</small></p></blockquote></ul><p><a href="/assets/images/Post04/intunewin.png" class="popup img-link shimmer"><img src="/assets/images/Post04/intunewin.png" alt="Intunewin" loading="lazy"></a> <em>Obs: Criei a origem e a sa√≠da no mesmo diret√≥rio, mas recomendo que fa√ßam em diret√≥rios separados, para mitigar poss√≠veis erros.</em></p><p><strong>Agora, vamos criar o Aplicativo no Intune:</strong></p><ol><li>V√° para o portal do <a href="https://intune.microsoft.com/" target="_blank" rel="noopener noreferrer">Microsoft Intune</a>;<br /><li>Navegue at√© <strong>Apps</strong> &gt; <strong>Windows</strong> &gt; <strong>+ Create</strong>;<li>App Type: <strong>Windows App (Win32)</strong>;<li>App information: Selecione o arquivo <strong>install.intunewin</strong> que voc√™ criou;<li>Preencha os detalhes (Name, Description, Publisher, Category, etc);</ol><ul><li><span style="color:orange;">Install command:</span> <code class="language-plaintext highlighter-rouge">%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe -ExecutionPolicy Bypass -File .\install.ps1</code><li><span style="color:orange;">Uninstall command</span> (Opcional)<span style="color:orange;">:</span> <code class="language-plaintext highlighter-rouge">%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe -ExecutionPolicy Bypass -File .\uninstall.ps1</code><ul><li>Voc√™ precisaria criar este uninstall.ps1 e empacot√°-lo junto se quiser essa funcionalidade;<li>√â recomendado ter um script que remova as chaves de registro, se necess√°rio;</ul><li><span style="color:orange;">Install behavior:</span> <strong><em>System</em></strong> (para garantir permiss√µes adequadas para escrever em HKLM e C:\MDM);<li><span style="color:orange;">Requirements:</span> Especifique a arquitetura do SO (32/64 bits) e a vers√£o m√≠nima do Windows;<li><span style="color:orange;">Detection rules:</span><ul><li><span style="color:orange;">Rules format:</span> <strong>Use a custom detection script</strong>;<li><span style="color:orange;">Script file:</span> Fa√ßa upload do seu arquivo <strong>detect.ps1</strong>;<li><span style="color:orange;">Run script as 32-bit process on 64-bit clients:</span> <strong>N√£o</strong> (geralmente);<li><span style="color:orange;">Enforce script signature check and run script silently:</span> <strong>N√£o</strong> (a menos que seus scripts estejam assinados);</ul><li><span style="color:orange;">Dependencies:</span> (Geralmente n√£o necess√°rio para este caso);<li><span style="color:orange;">Supersedence:</span> (Geralmente n√£o necess√°rio para este caso);<li><span style="color:orange;">Assignments:</span> Atribua o aplicativo aos grupos de dispositivos desejados (ex: Todos os dispositivos Windows);<li><span style="color:orange;">Review + create:</span> Revise todas as configura√ß√µes e crie o aplicativo;</ul><p><a href="/assets/images/Post04/config-app.png" class="popup img-link shimmer"><img src="/assets/images/Post04/config-app.png" alt="ConfigApp" loading="lazy"></a> <a href="/assets/images/Post04/detect.png" class="popup img-link shimmer"><img src="/assets/images/Post04/detect.png" alt="Detect" loading="lazy"></a></p><h2 id="-conclus√£o"><span class="me-2">‚úÖ Conclus√£o</span><a href="#-conclus√£o" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p style="text-align: justify;">Embora a configura√ß√£o inicial de papel de parede no <strong>Windows 10/11 Pro</strong> via Intune exija uma solu√ß√£o alternativa usando scripts e aplicativos Win32, a abordagem detalhada aqui oferece uma flexibilidade significativa.</p><p style="text-align: justify;">Ao combinar um script de instala√ß√£o com um script de detec√ß√£o inteligente baseado em *timestamp* de arquivo, voc√™ pode n√£o apenas definir as imagens corporativas, mas tamb√©m atualiz√°-las dinamicamente simplesmente alterando os arquivos de origem em seu reposit√≥rio (como o Blob Storage), sem precisar tocar na configura√ß√£o do Intune novamente.</p><p style="text-align: justify;">Esta t√©cnica demonstra o poder da automa√ß√£o com PowerShell e a flexibilidade da implanta√ß√£o de aplicativos Win32 no Intune para superar limita√ß√µes e gerenciar configura√ß√µes complexas de forma eficiente.</p><p>Espero que este tutorial ajude voc√™ a manter um ambiente de trabalho padronizado e atualizado para seus usu√°rios do Windows 10/11 Pro!</p><p>Bom, √© isso hoje. At√© a pr√≥xima! ü§ò</p></div><div class="post-share"> <span class="share-label">Compartilhe</span><div class="share-icons"> <a href="https://x.com/intent/tweet?url=https://tonho.cloud/posts/WallpaperIntune/" target="_blank" title="X"> <i class="fab fa-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://tonho.cloud/posts/WallpaperIntune/" target="_blank" title="Facebook"> <i class="fab fa-facebook"></i> </a> <a href="https://api.whatsapp.com/send?text=https://tonho.cloud/posts/WallpaperIntune/" target="_blank" title="WhatsApp"> <i class="fab fa-whatsapp"></i> </a> <a href="https://t.me/share/url?url=https://tonho.cloud/posts/WallpaperIntune/" target="_blank" title="Telegram"> <i class="fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://tonho.cloud/posts/WallpaperIntune/" target="_blank" title="LinkedIn"> <i class="fab fa-linkedin"></i> </a> <a href="#" onclick="navigator.clipboard.writeText('https://tonho.cloud/posts/WallpaperIntune/'); alert('Link copiado!'); return false;" title="Copiar link"> <i class="fas fa-link"></i> </a></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Atualizados recentemente</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/PermissionExchange/">SYSTEM aplicando permiss√µes no Exchange Online: normal ou sinal de alerta?</a><li class="text-truncate lh-lg"> <a href="/posts/AzurePIM-Parte2/">Configura√ß√µes do Microsoft Entra PIM com PowerShell</a><li class="text-truncate lh-lg"> <a href="/posts/AzurePIM/">Mapeamento de Rule IDs no Microsoft Entra PIM</a><li class="text-truncate lh-lg"> <a href="/posts/WallpaperIntune/">Definir Wallpaper via Intune com Atualiza√ß√£o Din√¢mica</a><li class="text-truncate lh-lg"> <a href="/posts/PhishingProtection/">Como habilitar o Enhanced Phishing Protection</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/azure/">Azure</a> <a class="post-tag btn btn-outline-primary" href="/tags/entra-id/">Entra ID</a> <a class="post-tag btn btn-outline-primary" href="/tags/microsoft-365/">Microsoft 365</a> <a class="post-tag btn btn-outline-primary" href="/tags/microsoft365/">Microsoft365</a> <a class="post-tag btn btn-outline-primary" href="/tags/endpoint/">Endpoint</a> <a class="post-tag btn btn-outline-primary" href="/tags/intune/">Intune</a> <a class="post-tag btn btn-outline-primary" href="/tags/least-privilege/">Least Privilege</a> <a class="post-tag btn btn-outline-primary" href="/tags/pim/">PIM</a> <a class="post-tag btn btn-outline-primary" href="/tags/azure-ad/">Azure AD</a> <a class="post-tag btn btn-outline-primary" href="/tags/conditional-access/">Conditional Access</a></div></section></div></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><footer class="footer"><div class="footer__hr"></div><div class="footer__bottom"><p>¬© 2025 <strong>Antonio Luciano</strong>. Alguns direitos reservados.</p></div></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/azure/">Azure</a> <a class="post-tag btn btn-outline-primary" href="/tags/entra-id/">Entra ID</a> <a class="post-tag btn btn-outline-primary" href="/tags/microsoft-365/">Microsoft 365</a> <a class="post-tag btn btn-outline-primary" href="/tags/microsoft365/">Microsoft365</a> <a class="post-tag btn btn-outline-primary" href="/tags/endpoint/">Endpoint</a> <a class="post-tag btn btn-outline-primary" href="/tags/intune/">Intune</a> <a class="post-tag btn btn-outline-primary" href="/tags/least-privilege/">Least Privilege</a> <a class="post-tag btn btn-outline-primary" href="/tags/pim/">PIM</a> <a class="post-tag btn btn-outline-primary" href="/tags/azure-ad/">Azure AD</a> <a class="post-tag btn btn-outline-primary" href="/tags/conditional-access/">Conditional Access</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">Uma nova vers√£o do conte√∫do est√° dispon√≠vel.</p><button type="button" class="btn btn-primary" aria-label="Update"> atualiza√ß√£o </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! Nenhum resultado encontrado.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
